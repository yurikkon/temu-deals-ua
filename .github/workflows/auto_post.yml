name: Auto Post Deals

on:
  schedule:
    # –ü–æ—Å—Ç–∏–Ω–≥ 5 —Ä–∞–∑ –≤ –¥–µ–Ω—å: 9, 12, 15, 18, 21 –ø–æ UTC
    - cron: '0 9 * * *'   # 9:00 UTC
    - cron: '0 12 * * *'  # 12:00 UTC
    - cron: '0 15 * * *'  # 15:00 UTC
    - cron: '0 18 * * *'  # 18:00 UTC
    - cron: '0 21 * * *'  # 21:00 UTC
  workflow_dispatch:

jobs:
  post-deal:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install python-telegram-bot aiohttp
      
      - name: Post deal to Telegram
        run: |
          python3 << 'EOF'
import asyncio
from telegram import Bot
import os

TOKEN = os.environ['TELEGRAM_TOKEN']
CHANNEL = os.environ['CHANNEL_ID']
AFFILIATE = os.environ['AFFILIATE_CODE']

DEALS = [
    ('üî• –ù–∞—É—à–Ω–∏–∫–∏ Bluetooth 5.3', '$49.99', '$19.99', '60%', 'electronics/headphones', '—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞'),
    ('üî• –£–º–Ω—ã–µ —á–∞—Å—ã Smart Watch', '$79.99', '$29.99', '63%', 'electronics/smartwatch', '—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞'),
    ('üç≥ –ù–∞–±–æ—Ä –ø–æ—Å—É–¥—ã 12—à—Ç', '$59.99', '$24.99', '58%', 'home/cookware', '–¥–æ–º'),
    ('üí® –£–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å –≤–æ–∑–¥—É—Ö–∞', '$34.99', '$14.99', '57%', 'home/humidifier', '–¥–æ–º'),
    ('üíÑ –ù–∞–±–æ—Ä –º–∞–Ω–∏–∫—é—Ä–∞ 48—à—Ç', '$29.99', '$12.99', '57%', 'beauty/manicure', '–∫—Ä–∞—Å–æ—Ç–∞'),
    ('üéß –ù–∞—É—à–Ω–∏–∫–∏ ANC', '$89.99', '$34.99', '61%', 'electronics/headphones-noise', '—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞'),
    ('üì± –ß–µ—Ö–æ–ª iPhone 15', '$24.99', '$8.99', '64%', 'electronics/iphone-case', '—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞'),
    ('üßπ –†–æ–±–æ—Ç-–ø—ã–ª–µ—Å–æ—Å', '$129.99', '$49.99', '62%', 'home/vacuum', '–¥–æ–º'),
    ('üí™ –§–∏—Ç–Ω–µ—Å-—Ä–µ–∑–∏–Ω–∫–∏', '$24.99', '$9.99', '60%', 'sports/bands', '—Å–ø–æ—Ä—Ç'),
    ('‚òï –ö–æ—Ñ–µ–º–∞—à–∏–Ω–∞', '$79.99', '$29.99', '63%', 'home/coffee', '–¥–æ–º'),
    ('üí° –°–º–∞—Ä—Ç-–ª–∞–º–ø–∞', '$34.99', '$12.99', '63%', 'electronics/smart-lamp', '—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞'),
    ('üéÅ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ —É–∫—Ä–∞—à–µ–Ω–∏—è', '$39.99', '$14.99', '63%', 'home/decor', '–¥–æ–º'),
]

import random
title, old, new, disc, url, cat = random.choice(DEALS)

message = f'''üî• <b>{title}</b>

üí∞ <s>{old}</s> ‚Üí <b>{new}</b>
üìâ –°–∫–∏–¥–∫–∞: {disc}

üîó <a href="https://www.temu.com/ua/{url}?_r={AFFILIATE}">–ö—É–ø–∏—Ç—å –Ω–∞ Temu</a>

#{cat} #—Å–∫–∏–¥–∫–∞ #—Ç–æ–ø'''

async def post():
    bot = Bot(token=TOKEN)
    await bot.send_message(chat_id=CHANNEL, text=message, parse_mode='HTML')
    print(f'‚úÖ Posted: {title}')

asyncio.run(post())
EOF
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          CHANNEL_ID: ${{ secrets.CHANNEL_ID }}
          AFFILIATE_CODE: ${{ secrets.TEMU_AFFILIATE_CODE }}
